# Processing a vocabulary spreadsheet

**Title:** Processing a vocabulary spreadsheet

**Date Modified:** 2020-06-14

**Part of TDWG Standard:** Not part of any standard

**Abstract:** Once vocabulary developers have defined terms using a spreadsheet, the data in that spreadsheet can be processed into other forms used to generate human and machine readable representations of the data in the spreadsheet. This document provides information about how to use scripts to generate those representations.

**Contributors:** Steve Baskauf (TDWG Technical Architecture Group, TDWG Audubon Core Maintenance Group, TDWG Darwin Core Maintenance Group)

# Table of Contents

[1 Introduction](#introduction)

[2 Generating necessary CSV files from the hand-generated CSV file](#2-generating-necessary-csv-files-from-the-hand-generated-csv-file)

[3 Creating a column header mapping file](#3-creating-a-column-header-mapping-file)

[4 Term list build script](#4-term-list-build-script)

# 1 Introduction

The [TDWG Standards Documentation Specification](http://rs.tdwg.org/sds/doc/specification/) (SDS) indicates that all human and machine readable representations of vocabulary components should provide the same data. That can be achieved by using a script to generate those representations from a common data source: CSV files generated from a [basic CSV file created by the vocabulary developers](create-vocabulary.md). The process is similar regardless of whether it is a new vocabulary or if modifications are being made to an existing vocabulary.

![generation of metadata tables](images/table-generation.png)

A Python script uses the data present in the hand-generated CSV files to generate several CSV files that contain all of the metadata required by the SDS. The data are used to generate specific term versions and to update the current terms by automatically adding some fields that are generated by the script. The script also links the versions to the current terms in a join table.

![generation of machine readable metadata](images/machine-readable-mapping.png)

Data in the generated current terms CSV file is used with a mapping table to generate machine-readable metadata about the terms. The mapping table is hand-generated when the vocabulary is first created and relates the header names in the current terms CSV file to the abbreviated property IRIs used in the machine readable representation.

![generation of human readable document](images/human-readable-mapping.png)

The current terms CSV file can also be used along with a Python build script to create a human readable terms list document. 

During the initial vocabulary development process, the build script can be used to generate draft term list documents for review. Re-running the build script will cause changes or corrections made to the hand generated CSV file to be reflected in a revised term list document.

# 2 Generating necessary CSV files from the hand-generated CSV file

There are several steps required generate all of the metadata related to term additions or changes. New versions of the terms must be created, then the metadata record for the current term use be created (if the term is new) or modified (if the term is revised). The version is then linked to its corresponding current term. 

![TDWG metadata model](https://raw.githubusercontent.com/tdwg/vocab/master/tdwg-standards-hierarchy-2017-01-23.png)

Whenever a term is added or changed, that triggers new versions at all of the higher levels in the TDWG standards hierarchy. New term versions trigger new term list versions. New term list versions trigger new vocabulary versions and new vocabulary versions trigger new standards versions.

## 2.1 Generating term versions

Each current term is related to at least one term version.

![TDWG versions model](https://github.com/tdwg/vocab/raw/master/graphics/version-model.png)

Each time a term's metadata is revised, a new version is created. The term version IRI is formed by appending the date of issue to the term local name. A `hasVersion` relationship is created between the term and its version, and the new version has a `replaces` relationship with the previous version. The metadata defining these relationships are generated by the processing script and the definition, usage, and notes are copied from the hand-generated CSV file.

## 2.2 Revising current term metadata

If a term is being revised, its metadata are changed according to the information in the hand-generated CSV file and the last-modified date for that term is updated. If the term is new, its record is created and the last-modified date is set to be the same as the created date. 

## 2.3 Asignment of term versions to a new term list version

A term list is a group of related terms that share the same namespace part of their IRI. As with all TDWG resources, term lists also have versions. When a term is changed or added, the new term version is added to a new version of the term list (replacing any older version if necessary). If a term is new, it is also added to the existing term list. 

## 2.4 Proliferation of new versions up the hierarchy

A new term list version is updated in its parent vocabulary version and a new vocabulary version is updated in its parent standard version. A new term list is only added to its parent vocabulary if it represents terms in a namespace that is not already represented in the vocabulary.

# 3 Creating a column header mapping file

Because the SDS requires particular properties to be included in term metadata, if the template hand-generated CSV file is used without editing the column headers, a template column header mapping file can be used as well. The column header mapping file only needs to be modified if additional property columns are added to the template CSV file. This may happen if specialty properties such as `tdwgutility:organizedInClass` are added to the required properties.

Controlled vocabularies contain one or more additional properties that are not found in vocabularies that define properties and classes. That includes the controlled value string and may also include a property to indicate that a value has a `broader` relationship to another concept. So controlled vocabularies should use the template column header mapping file designed for controlled vocabularies.

# 4 Term list build script

A term list document is a Markdown document consisting of two parts. The first part is a hand-edited static file that contains the introductory material (header section, introduction, RFC 2119 keywords section, etc.). The second part is created by a script that generates the actual term list from the current terms files for term lists that are included in the vocabulary. The script is relatively simple if all terms are found in a single term list. It is more complex if the vocabulary includes terms from several term lists or if the terms are categorized. There are several example build scripts that can be modified by a Python programmer needed to make the term list document conform to the idiosyncrasies of a given vocabulary.